/*! angularjs-slider - v0.1.2 - (c) Rafal Zajac <rzajac@gmail.com>, https://github.com/rzajac/angularjs-credit-card-input.git - 2014-01-07 */
angular.module("rzModule",[]).factory("CcInput",["$timeout",function(){var a=function(a,b){this.scope=a,this.ccInput=b,this.ccLogo=null,this.ccNumber=null,this.ccExpYear=null,this.ccExpMonth=null,this.ccCcv=null,this.init()};return a.prototype={init:function(){this.initElemHandles(),this.bindEvents()},initElemHandles:function(){angular.forEach(this.ccInput.children(),function(a,b){var c=angular.element(a);switch(b){case 0:this.ccLogo=c,this.ccLogo[0].ccField="logo";break;case 1:this.ccNumber=c,this.ccNumber[0].ccField="number";break;case 2:this.ccExpMonth=c,this.ccExpMonth[0].ccField="eMonth";break;case 3:this.ccExpYear=c,this.ccExpYear[0].ccField="eYear";break;case 4:this.ccCcv=c,this.ccCcv[0].ccField="ccv"}},this)},bindEvents:function(){this.ccInput.on("keypress keydown",angular.bind(this,this.onKey))},onKey:function(a){var b=a.keyCode,c=this.isNumber(b)?String.fromCharCode(a.keyCode):"";switch(console.log("ok",b),a.preventDefault(),a.stopPropagation(),a.target.ccField){case"number":this.handleCCNumber(c,b);break;case"eMonth":this.handleCCMonth(c,b);break;case"eYear":this.handleCCYear(c,b);break;case"ccv":this.handleCCV(c,b)}},isNumber:function(a){return a>=48&&57>=a},handleCCNumber:function(a,b){var c,d=this.ccNumber.val()+a,e=d.length;if(d=this.formatCCN(d),c=this.getCardType(d)+"-32px",8==b)d=d.substr(0,e-1).trim();else if(19==e)this.focusPos=1,this.ccExpMonth[0].focus();else if(e>19)return this.handleCCMonth(a,b),this.ccExpMonth[0].focus(),void 0;this.ccNumber.val(d),this.ccLogo.removeClass("vi-32px ae-32px mc-32px ds-32px na-32px").addClass(c),this.scope.$apply()},handleCCMonth:function(a,b){var c=this.ccExpMonth.val()+a,d=c.length;if(0===d&&8==b)this.ccNumber[0].focus();else if(8==b)c=c.substr(0,d-1);else if(2===d)this.focusPos=2,this.ccExpYear[0].focus();else if(d>2)return this.handleCCYear(a,b),this.ccExpYear[0].focus(),void 0;this.ccExpMonth.val(c),this.scope.rzCardExpMonth=c,this.scope.$apply()},handleCCYear:function(a,b){var c=this.ccExpYear.val()+a,d=c.length;if(0===d&&8==b)this.ccExpMonth[0].focus();else if(8==b)c=c.substr(0,d-1);else if(2===d)this.focusPos=3,this.ccCcv[0].focus();else if(d>2)return this.handleCCV(a,b),this.ccCcv[0].focus(),void 0;this.ccExpYear.val(c),this.scope.rzCardExpYear=c,this.scope.$apply()},handleCCV:function(a,b){var c=this.ccCcv.val()+a,d=c.length;if(0===d&&8==b)this.ccExpYear[0].focus();else if(8==b)c=c.substr(0,d-1);else if(d>3)return;this.ccCcv.val(c),this.scope.rzCardCcv=c,this.scope.$apply()},formatCCN:function(a){return a=a.trim().replace(/ /g,""),this.scope.rzCardNumber=a,a=a.match(/.{1,4}/g),a?a.join(" ").trim():""},getCardType:function(a){var b="na";return a.length<3?b:(null!==a.match(/^4[4-7]/)?b="ae":null!==a.match(/^5[1-5]/)?b="mc":null!==a.match(/^4/)?b="vi":null!==a.match(/^6011|65/)&&(b="ds"),b)}},a}]).directive("ccinput",["CcInput",function(a){return{restrict:"E",scope:{rzCardNumber:"=",rzCardExpMonth:"=",rzCardExpYear:"=",rzCardCcv:"="},template:'<span class="ccLogo na-32px"></span><input class="ccNumber" type="tel" placeholder="1234 1234 1234 1234"/><input class="ccExpMonth" type="number" placeholder="MM"/><input class="ccExpYear" type="number" placeholder="YY"/><input class="ccCcv" type="number" placeholder="CCV"/>',link:function(b,c,d){return new a(b,c,d)}}}]);